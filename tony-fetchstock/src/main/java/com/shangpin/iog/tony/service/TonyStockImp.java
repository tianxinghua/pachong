package com.shangpin.iog.tony.service;

import com.google.gson.Gson;
import com.shangpin.framework.ServiceException;

import com.shangpin.iog.common.utils.UUIDGenerator;
import com.shangpin.iog.dto.SupplierStockDTO;
import com.shangpin.iog.tony.common.Constant;
import com.shangpin.iog.tony.common.MyJsonClient;

import com.shangpin.iog.tony.dto.EventDTO;
import com.shangpin.iog.tony.dto.ReturnDTO;
import org.apache.log4j.Logger;
import org.springframework.stereotype.Service;

import java.util.*;

/**
 * Created by wangyuzhi on 2015/9/14.
 */
@Service("tonyfetch")
public class TonyStockImp {
    private static Logger logger = Logger.getLogger("info");
    private static Logger loggerError = Logger.getLogger("error");


    public void  fetchStock() {
        String json = new MyJsonClient().getEvents();
        Gson gson = new Gson();
        ReturnDTO returnDTO=gson.fromJson(json, ReturnDTO.class );//new TypeToken<List<SaleDTO>>(){}.getType()
        Map<String,Integer> stockMap = new HashMap<>();
        if("ok".equals(returnDTO.getStatus())){
            List<EventDTO>  eventDTOs  = returnDTO.getData().getEvents();
            if(null!=eventDTOs){
                for(EventDTO eventDTO:eventDTOs){
                    if(0==eventDTO.getType()){//购买减少库存
                        //0: the quantity of the involved product is changed (you can find a sku attribute to identify the product and a qty attribute that contains the new quantity you have to display on your selling channel);
                        stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                    }else if(1==eventDTO.getType()){
                        //1: the involved item was removed from the stock (you can find the sku attribute to identify the product and you have to put the quantity to 0)
                        stockMap.put(eventDTO.getAdditional_info().getSku(),0);
                    }else if(2==eventDTO.getType()){
                        //  2: the inventory was updated and you have to reload all the inventory using the proper web service (the getItemsList web service)
                    }else if(3==eventDTO.getType()){
                         //3: the item was upserted. It means that the involved item was added to the inventory or updated. You can find the item directly in the event and you have to refresh the info on your selling channel
                    }else if(4==eventDTO.getType()){
                        // 4 the item changed quantity or the stock price. You can find in the event the sku attribute of the involved product, the qty attribute (that you have to display on your selling channel), the qty_diff attribute (not important in this case) and the stock price
//                        if(0==eventDTO.getAdditional_info().getStock_price()){//停止销售
//                            stockMap.put(eventDTO.getAdditional_info().getSku(),0);
//                        }else{
                            stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
//                        }
                    }
                }
                for(Iterator<Map.Entry<String,Integer>> itor= stockMap.entrySet().iterator();itor.hasNext();){
                    Map.Entry<String,Integer> entry  = itor.next();
                    SupplierStockDTO supplierStockDTO = new SupplierStockDTO();
                    supplierStockDTO.setSupplierId(Constant.SUPPLIER_ID);
                    supplierStockDTO.setId(UUIDGenerator.getUUID());
                    supplierStockDTO.setSupplierSkuNo(entry.getKey());
                    supplierStockDTO.setQuantity(entry.getValue());


                }

            }

        }
    }


    public static void main(String[] args) throws Exception {
        TonyStockImp impl = new TonyStockImp();
/*        SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm");
        logger.info("TESSABIT更新数据库开始");
        impl.updateProductStock("2015091501331", "2015-01-01 00:00", format.format(new Date()));
        logger.info("TESSABIT更新数据库结束");
        System.exit(0);*/

//        List<String> skuNo = new ArrayList<>();
//        skuNo.add("356530S1533_1500-40");
//        skuNo.add("356530S1533_1000-40");
//        Map returnMap = impl.grabStock(skuNo);
//        System.out.println("test return size is "+returnMap.keySet().size());
/*        for (Object key:returnMap.keySet()){
            System.out.print("key is " + key);
            System.out.println(",value is "+returnMap.get(key));
        }*/

         long start = 0;//计时开始时间
         long end = 0;//计时结束时间
        start = System.currentTimeMillis();
//        String json = new MyJsonClient().getEvents();
        //String json = "rtnData=={\"status\":\"ok\",\"data\":{\"events\":[{\"_id\":{\"$id\":\"561e6e2be4b0b71d53085f0f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":1,\"date\":{\"sec\":1444834859,\"usec\":487000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"from\":\"shop\",\"sku\":\"356530S1533_1000-40\",\"order_id\":{\"$id\":\"561e6e21e4b0b71d53085f07\"}}},{\"_id\":{\"$id\":\"561e745fe4b0269c2a643f68\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1444836447,\"usec\":622000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"356530S1533_1500-40\",\"order_id\":{\"$id\":\"561e7455e4b0269c2a643f60\"}}},{\"_id\":{\"$id\":\"561e775ce4b0b5f049525a41\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1444837212,\"usec\":802000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":1,\"from\":\"shop\",\"sku\":\"356530S1533_1500-40\",\"order_id\":{\"$id\":\"561e7752e4b0b5f049525a38\"}}},{\"_id\":{\"$id\":\"561e77a2e4b0b5f049525a4b\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1444837282,\"usec\":801000},\"additional_info\":{\"qty_diff\":-3,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":4,\"from\":\"shop\",\"sku\":\"356530S1533_1500-40\",\"order_id\":{\"$id\":\"561e7798e4b0b5f049525a42\"}}},{\"_id\":{\"$id\":\"561e7d36e4b0c01df26d77e9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1444838710,\"usec\":853000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"qty\":4,\"from\":\"shop\",\"sku\":\"356530S1533_1000-40\",\"order_id\":{\"$id\":\"561e7d2ce4b0c01df26d77e0\"}}}]}}";
       String json ="{\"status\":\"ok\",\"data\":{\"events\":[{\"_id\":{\"$id\":\"56276091e4b010fbf3b749dc\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421201,\"usec\":682000},\"additional_info\":{\"qty_diff\":null,\"qty\":4,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"30H3GTVT8LJETSETTRAVEL_655-TU\"}},{\"_id\":{\"$id\":\"5627609be4b010fbf3b749f9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421211,\"usec\":684000},\"additional_info\":{\"qty_diff\":null,\"qty\":6,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"30S4GTVT2LJETSETTRAVEL_655-TU\"}},{\"_id\":{\"$id\":\"562760a5e4b010fbf3b74a16\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421221,\"usec\":683000},\"additional_info\":{\"qty_diff\":null,\"qty\":5,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"30T3GTVT7LJETSETTRAVEL_655-TU\"}},{\"_id\":{\"$id\":\"562760afe4b010fbf3b74d6c\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421231,\"usec\":686000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":4,\"from\":\"shop\",\"sku\":\"8BH2793M2_F022F-TU\",\"order_id\":{\"$id\":\"56276094e4b010fbf3b749e5\"}}},{\"_id\":{\"$id\":\"562760b9e4b010fbf3b74d88\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421241,\"usec\":684000},\"additional_info\":{\"qty_diff\":null,\"qty\":5,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"30T5GTVT2LJETSETTRAVEL_655-TU\"}},{\"_id\":{\"$id\":\"562760c3e4b010fbf3b74d9e\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421251,\"usec\":684000},\"additional_info\":{\"qty_diff\":null,\"qty\":4,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"32H4GCPC7LCINDY_655-TU\"}},{\"_id\":{\"$id\":\"562760cde4b010fbf3b74db5\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421261,\"usec\":683000},\"additional_info\":{\"qty_diff\":null,\"qty\":30,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"32S3GTVE3LJETSETTRAVEL_001-TU\"}},{\"_id\":{\"$id\":\"562760d7e4b010fbf3b74dcb\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421271,\"usec\":688000},\"additional_info\":{\"qty_diff\":null,\"qty\":8,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"32S3GTVE3LJETSETTRAVEL_406-TU\"}},{\"_id\":{\"$id\":\"562760e1e4b010fbf3b74de1\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421281,\"usec\":686000},\"additional_info\":{\"qty_diff\":null,\"qty\":6,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"32S3GTVE3LJETSETTRAVEL_655-TU\"}},{\"_id\":{\"$id\":\"562760ebe4b010fbf3b74df6\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421291,\"usec\":686000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":4,\"from\":\"shop\",\"sku\":\"189751F4F5R_9791-TU\",\"order_id\":{\"$id\":\"5627609ee4b010fbf3b74a02\"}}},{\"_id\":{\"$id\":\"562760f5e4b010fbf3b74e0d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421301,\"usec\":686000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"388735QFK04_3250-42\"}},{\"_id\":{\"$id\":\"562760ffe4b010fbf3b74e22\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421311,\"usec\":687000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"388735QFK04_3250-44\"}},{\"_id\":{\"$id\":\"56276109e4b010fbf3b74e38\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421321,\"usec\":686000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"394089QFJ02_1000-40\"}},{\"_id\":{\"$id\":\"56276113e4b010fbf3b74e4f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421331,\"usec\":687000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"394089QFJ02_1000-42\"}},{\"_id\":{\"$id\":\"5627611de4b010fbf3b74e65\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445421341,\"usec\":688000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"394089QFJ02_1000-44\"}},{\"_id\":{\"$id\":\"56276127e4b010fbf3b74e7b\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421351,\"usec\":685000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"30F4GTVT1LJETSETTRAVEL_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276131e4b010fbf3b74e90\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421361,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"30H3GTVT8LJETSETTRAVEL_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627613be4b010fbf3b74ea6\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421371,\"usec\":688000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":7,\"from\":\"shop\",\"sku\":\"30S4GTVT2LJETSETTRAVEL_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276145e4b010fbf3b74ebd\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421381,\"usec\":685000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"30T3GTVT7LJETSETTRAVEL_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627614fe4b010fbf3b74ed2\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421391,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"30T5GTVT2LJETSETTRAVEL_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276159e4b010fbf3b74ee9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421401,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"32H4GCPC7LCINDY_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276163e4b010fbf3b74efe\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421411,\"usec\":686000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":31,\"from\":\"shop\",\"sku\":\"32S3GTVE3LJETSETTRAVEL_001-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627616de4b010fbf3b74f14\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421421,\"usec\":686000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":9,\"from\":\"shop\",\"sku\":\"32S3GTVE3LJETSETTRAVEL_406-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276177e4b010fbf3b74f2a\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421431,\"usec\":687000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":7,\"from\":\"shop\",\"sku\":\"32S3GTVE3LJETSETTRAVEL_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276181e4b010fbf3b74f40\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421441,\"usec\":690000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"388735QFK04_3250-42\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627618be4b010fbf3b74f57\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421451,\"usec\":690000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"394089QFJ02_1000-40\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276195e4b010fbf3b74f6c\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421461,\"usec\":690000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"396072QFZ26_0902-42\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627619fe4b010fbf3b74f82\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421471,\"usec\":691000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"404743Q1VTX_9901-S\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562761a9e4b010fbf3b74f99\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421481,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"3938200HORSEFERRYCHECK_TAN-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562761b3e4b010fbf3b74faf\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421491,\"usec\":687000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"3958936LLMDSYCAMOREHSRABMVV_26700-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562761bde4b010fbf3b74fc5\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421501,\"usec\":691000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":4,\"from\":\"shop\",\"sku\":\"3977779JAMES35NRVOS_BLACK-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562761c7e4b010fbf3b74fda\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421511,\"usec\":692000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"BB5935AC266_8K869-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562761d1e4b010fbf3b74ff0\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421521,\"usec\":692000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"BB5998A1001_80648-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562761dbe4b010fbf3b75007\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421531,\"usec\":691000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"BB5999A1001_80001-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562761e5e4b010fbf3b7501d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421541,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"BB6002A1001_80648-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562761efe4b010fbf3b75032\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421551,\"usec\":692000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"BB6002A1001_80999-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562761f9e4b010fbf3b75049\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421561,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"BB6002A1001_80999-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276203e4b010fbf3b7505f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421571,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"BB6002A1001_89613-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627620de4b010fbf3b75075\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421581,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"BB6003A1001_80999-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276217e4b010fbf3b7508b\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421591,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":4,\"from\":\"shop\",\"sku\":\"BB6003A1001_80999-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276221e4b010fbf3b750a0\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421601,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"BB6015A1001_80999-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627622be4b010fbf3b750b7\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421611,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"BB6015A1001_80999-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276235e4b010fbf3b750cd\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421621,\"usec\":688000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"BB6071A1095_80303-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627623fe4b010fbf3b750e2\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421631,\"usec\":694000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"BI0653A1001_80999-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276249e4b010fbf3b750f9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421641,\"usec\":692000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"BI0653A1001_80999-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276253e4b010fbf3b7510f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421651,\"usec\":690000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"CG0012A1471_80063-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627625de4b010fbf3b75125\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421661,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"CN0014AL348_8B956-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276267e4b010fbf3b7513a\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421671,\"usec\":689000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"CT0075A2768_89690-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276271e4b010fbf3b75150\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421681,\"usec\":690000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"F6ST0TFC3CU_S8030-40\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627627be4b010fbf3b75167\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421691,\"usec\":695000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"G9FE2TG7EEL_B0665-48\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276285e4b010fbf3b7517d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421701,\"usec\":695000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"W15A213094_M023-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627628fe4b010fbf3b75193\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421711,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"W15C204109_2124-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276299e4b010fbf3b751a9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421721,\"usec\":691000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":15,\"from\":\"shop\",\"sku\":\"W15KA100101W_2124-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762a3e4b010fbf3b751bf\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421731,\"usec\":694000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"W15LO413025_2124-43\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762ade4b010fbf3b751d5\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421741,\"usec\":691000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"W15SC100101W_2121-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762b7e4b010fbf3b751ea\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421751,\"usec\":692000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"W15SC100201W_M350-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762c1e4b010fbf3b75200\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421761,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"W15SD2001557_M340-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762cbe4b010fbf3b75217\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421771,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"7AR3994CN_F0480-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762d5e4b010fbf3b7522d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421781,\"usec\":696000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"7AR4203FM_F0355-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762dfe4b010fbf3b75243\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421791,\"usec\":696000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"7AR4213FM_F0357-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762e9e4b010fbf3b75259\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421801,\"usec\":698000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"8BH185G87_F0QT2-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762f3e4b010fbf3b7526e\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421811,\"usec\":696000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":17,\"from\":\"shop\",\"sku\":\"8BH2503WL_F031Q-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562762fde4b010fbf3b75284\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421821,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":7,\"from\":\"shop\",\"sku\":\"8BH25343T_F042D-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276307e4b010fbf3b7529b\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421831,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":18,\"from\":\"shop\",\"sku\":\"8BH253D7E_F0QA1-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276311e4b010fbf3b752b0\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421841,\"usec\":696000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"8BH2793M2_F022F-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627631be4b010fbf3b752c7\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421851,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":9,\"from\":\"shop\",\"sku\":\"8BH2793M2_F022G-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276325e4b010fbf3b752dd\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421861,\"usec\":694000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"8BH2793M2_F038K-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627632fe4b010fbf3b752f3\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421871,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"8BH2793M2_F0V8W-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276339e4b010fbf3b75308\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421881,\"usec\":696000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":7,\"from\":\"shop\",\"sku\":\"8BH2793WC_F031C-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276343e4b010fbf3b7531e\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421891,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":8,\"from\":\"shop\",\"sku\":\"8BH2793WC_F031C-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627634de4b010fbf3b75335\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421901,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":8,\"from\":\"shop\",\"sku\":\"8BH2793WC_F031D-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276357e4b010fbf3b7534a\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421911,\"usec\":692000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":9,\"from\":\"shop\",\"sku\":\"8BL1241D5_F0KR1-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276361e4b010fbf3b75360\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421921,\"usec\":698000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":8,\"from\":\"shop\",\"sku\":\"8BL1243PU_F023G-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627636be4b010fbf3b75376\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421931,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":7,\"from\":\"shop\",\"sku\":\"8BL1351D5_F0GXN-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276375e4b010fbf3b7538c\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421941,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":7,\"from\":\"shop\",\"sku\":\"8BL1351D5_F0NJ3-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627637fe4b010fbf3b753a2\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421951,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"8BR7202WD_F038N-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276389e4b010fbf3b753b8\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421961,\"usec\":696000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"8C05311D5_F022W-80\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276393e4b010fbf3b753ce\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421971,\"usec\":692000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"8C05311D5_F0KUR-80\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627639de4b010fbf3b753e4\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421981,\"usec\":692000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"8C05311D5_F0NJ3-80\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562763a7e4b010fbf3b753fb\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445421991,\"usec\":698000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"8C05311D5_F0QWM-80\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562763b1e4b010fbf3b75410\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422001,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"8D48383QP_F0P9L-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562763bbe4b010fbf3b75426\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422011,\"usec\":698000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"8X48373RH_F024P-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562763c5e4b010fbf3b7543c\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422021,\"usec\":693000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"G27D024GOLDEN_A4-S\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562763cfe4b010fbf3b75452\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422031,\"usec\":698000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"G27D024GOLDEN_A8-S\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562763d9e4b010fbf3b75468\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422041,\"usec\":696000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"G27D297AUGUSTA_A5-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562763e3e4b010fbf3b7547e\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422051,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"G27D409STARTER_A6-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562763ede4b010fbf3b75494\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422061,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"322500AGJ50_1060-10\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"562763f7e4b010fbf3b754ab\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422071,\"usec\":698000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"322500AGJ50_2152-10\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276401e4b010fbf3b754c0\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422081,\"usec\":702000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"387108Z4189_1276-48\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627640be4b010fbf3b754d6\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422091,\"usec\":691000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"388336CLG00_1000-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276415e4b010fbf3b754ed\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422101,\"usec\":700000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"388920CLG00_1000-38\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627641fe4b010fbf3b75502\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422111,\"usec\":699000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"388991AP00G_1000-85\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276429e4b010fbf3b75518\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422121,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"IU5049_C59582-43\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276433e4b010fbf3b7552e\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422131,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"1940MM82154793_98-M\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627643de4b010fbf3b75544\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422141,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"30H4STVT1LJETSETTRAVEL_562-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276447e4b010fbf3b7555a\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422151,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":6,\"from\":\"shop\",\"sku\":\"30T5TCYS2LCYNTHIA_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276451e4b010fbf3b75570\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422161,\"usec\":697000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":3,\"from\":\"shop\",\"sku\":\"30S4GTVS6LSELMA_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627645be4b010fbf3b75587\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422171,\"usec\":700000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":9,\"from\":\"shop\",\"sku\":\"30S4STVT2LJETSETTRAVEL_562-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"56276465e4b010fbf3b7559c\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422181,\"usec\":692000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"30S5GCPS3LCINDY_655-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}},{\"_id\":{\"$id\":\"5627646fe4b010fbf3b755b2\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1445422191,\"usec\":699000},\"additional_info\":{\"qty_diff\":-1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":5,\"from\":\"shop\",\"sku\":\"30T5STVT2LJETSETTRAVEL_562-TU\",\"order_id\":{\"$id\":\"562760a8e4b010fbf3b74a1f\"}}}]}}";
        end = System.currentTimeMillis();
        logger.info("获取events事件信息："+json+"，耗时："+(end-start)/1000+"秒");

//        Items[] array = new Gson().fromJson(new StringUtil().getItemsArray(itemsJson),
//                new TypeToken<Items[]>() {}.getType());
        Gson gson = new Gson();
        ReturnDTO returnDTO=gson.fromJson(json, ReturnDTO.class );//new TypeToken<List<SaleDTO>>(){}.getType()
        Map<String,Integer> stockMap = new HashMap<>();
        if("ok".equals(returnDTO.getStatus())){
           List<EventDTO>  eventDTOs  = returnDTO.getData().getEvents();
            for(EventDTO eventDTO:eventDTOs){
                if(0==eventDTO.getType()){//购买减少库存
                   stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                }else if(1==eventDTO.getType()){
                    stockMap.put(eventDTO.getAdditional_info().getSku(),0);
                }else if(2==eventDTO.getType()){
                    stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                }else if(3==eventDTO.getType()){
                    stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                }else if(4==eventDTO.getType()){
                    if(0==eventDTO.getAdditional_info().getStock_price()){//停止销售
                        stockMap.put(eventDTO.getAdditional_info().getSku(),0);
                    }else{
                        stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                    }

                }

            }


        }

        //定义三方
//        Map returnMap = new HashMap();
//        String key = "";
//        Integer value = null;
//        String[] strArr = json.split("additional_info");
//        System.out.println(strArr.length);
//        logger.info("为TESSABIT供应商产品库存循环赋值");
//        start = System.currentTimeMillis();
//        for (String item:strArr){
//            System.out.println(item+"===========");
//            key = MyStringUtil.getSkuId(item);
//            value = MyStringUtil.getQty(item);
//            System.out.println("Sku ID is - :"+key+",stock is "+value);
//            logger.info("Sku ID is "+key+",stock is "+value);
//            returnMap.put(key,value);
//        }
    }
}
