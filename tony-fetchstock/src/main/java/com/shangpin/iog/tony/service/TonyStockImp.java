package com.shangpin.iog.tony.service;

import com.google.gson.Gson;
import com.shangpin.framework.ServiceException;

import com.shangpin.framework.ServiceMessageException;
import com.shangpin.iog.common.utils.UUIDGenerator;
import com.shangpin.iog.common.utils.httpclient.HttpUtil45;
import com.shangpin.iog.common.utils.httpclient.OutTimeConfig;
import com.shangpin.iog.dto.SupplierStockDTO;
import com.shangpin.iog.service.SupplierStockService;
import com.shangpin.iog.tony.common.Constant;
import com.shangpin.iog.tony.common.MyJsonClient;

import com.shangpin.iog.tony.dto.EventDTO;
import com.shangpin.iog.tony.dto.ReturnDTO;
import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.*;

/**
 * Created by wangyuzhi on 2015/9/14.
 */
@Service("tonyfetch")
public class TonyStockImp {
    private static Logger logger = Logger.getLogger("info");
    private static Logger loggerError = Logger.getLogger("error");


    OutTimeConfig outTimeConfig =     new OutTimeConfig(1000 * 60 , 1000 * 60 , 1000 * 60);
    @Autowired
    SupplierStockService supplierStockService;
    public void  fetchStock() {

        Gson gson = new Gson();
        Map<String,Integer> stockMap = new HashMap<>();
        String json = Constant.EVENTS_INPUT;
        String rtnData ="";
        try {
            rtnData = HttpUtil45.operateData("post", "json", Constant.EVENTS_URL,outTimeConfig, null, json, "", "");
            System.out.println("rtnData=="+rtnData);
        } catch (ServiceException e) {
            e.printStackTrace();
        }



        ReturnDTO returnDTO=gson.fromJson(rtnData, ReturnDTO.class );//new TypeToken<List<SaleDTO>>(){}.getType()

        if("ok".equals(returnDTO.getStatus())){
            List<EventDTO>  eventDTOs  = returnDTO.getData().getEvents();
            if(null!=eventDTOs){
                for(EventDTO eventDTO:eventDTOs){
                    if(0==eventDTO.getType()){//购买减少库存
                        //0: the quantity of the involved product is changed (you can find a sku attribute to identify the product and a qty attribute that contains the new quantity you have to display on your selling channel);
                        stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                    }else if(1==eventDTO.getType()){
                        //1: the involved item was removed from the stock (you can find the sku attribute to identify the product and you have to put the quantity to 0)
                        stockMap.put(eventDTO.getAdditional_info().getSku(),0);
                    }else if(2==eventDTO.getType()){
                        //  2: the inventory was updated and you have to reload all the inventory using the proper web service (the getItemsList web service)
                    }else if(3==eventDTO.getType()){
                         //3: the item was upserted. It means that the involved item was added to the inventory or updated. You can find the item directly in the event and you have to refresh the info on your selling channel
                    }else if(4==eventDTO.getType()){
                        // 4 the item changed quantity or the stock price. You can find in the event the sku attribute of the involved product, the qty attribute (that you have to display on your selling channel), the qty_diff attribute (not important in this case) and the stock price
//                        if(0==eventDTO.getAdditional_info().getStock_price()){//停止销售
//                            stockMap.put(eventDTO.getAdditional_info().getSku(),0);
//                        }else{
                            stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
//                        }
                    }
                }
                for(Iterator<Map.Entry<String,Integer>> itor= stockMap.entrySet().iterator();itor.hasNext();){
                    Map.Entry<String,Integer> entry  = itor.next();
                    SupplierStockDTO supplierStockDTO = new SupplierStockDTO();
                    supplierStockDTO.setSupplierId(Constant.SUPPLIER_ID);
                    supplierStockDTO.setId(UUIDGenerator.getUUID());
                    supplierStockDTO.setSupplierSkuId(entry.getKey());
                    supplierStockDTO.setQuantity(entry.getValue());
                    supplierStockDTO.setOptTime(new Date());

                    try {
                        supplierStockService.saveStock(supplierStockDTO);
                    } catch (ServiceMessageException e) {
                        try {
                            if(e.getMessage().equals("数据插入失败键重复")){
                                //update
                                supplierStockService.updateStock(supplierStockDTO);

                            } else{
                                e.printStackTrace();
                            }

                        } catch (ServiceException e1) {
                            e1.printStackTrace();
                        }
                    }

                }

            }

        }
    }


    public static void main(String[] args) throws Exception {
/*        SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm");
        logger.info("TESSABIT更新数据库开始");
        impl.updateProductStock("2015091501331", "2015-01-01 00:00", format.format(new Date()));
        logger.info("TESSABIT更新数据库结束");
        System.exit(0);*/

//        List<String> skuNo = new ArrayList<>();
//        skuNo.add("356530S1533_1500-40");
//        skuNo.add("356530S1533_1000-40");
//        Map returnMap = impl.grabStock(skuNo);
//        System.out.println("test return size is "+returnMap.keySet().size());
/*        for (Object key:returnMap.keySet()){
            System.out.print("key is " + key);
            System.out.println(",value is "+returnMap.get(key));
        }*/

         long start = 0;//计时开始时间
         long end = 0;//计时结束时间
        start = System.currentTimeMillis();
//        String json = new MyJsonClient().getEvents();
        //String json = "rtnData=={\"status\":\"ok\",\"data\":{\"events\":[{\"_id\":{\"$id\":\"561e6e2be4b0b71d53085f0f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":1,\"date\":{\"sec\":1444834859,\"usec\":487000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"from\":\"shop\",\"sku\":\"356530S1533_1000-40\",\"order_id\":{\"$id\":\"561e6e21e4b0b71d53085f07\"}}},{\"_id\":{\"$id\":\"561e745fe4b0269c2a643f68\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1444836447,\"usec\":622000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":2,\"from\":\"shop\",\"sku\":\"356530S1533_1500-40\",\"order_id\":{\"$id\":\"561e7455e4b0269c2a643f60\"}}},{\"_id\":{\"$id\":\"561e775ce4b0b5f049525a41\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1444837212,\"usec\":802000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":1,\"from\":\"shop\",\"sku\":\"356530S1533_1500-40\",\"order_id\":{\"$id\":\"561e7752e4b0b5f049525a38\"}}},{\"_id\":{\"$id\":\"561e77a2e4b0b5f049525a4b\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1444837282,\"usec\":801000},\"additional_info\":{\"qty_diff\":-3,\"shop_from\":{\"$id\":\"561121e328499f880b0041a7\"},\"qty\":4,\"from\":\"shop\",\"sku\":\"356530S1533_1500-40\",\"order_id\":{\"$id\":\"561e7798e4b0b5f049525a42\"}}},{\"_id\":{\"$id\":\"561e7d36e4b0c01df26d77e9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":0,\"date\":{\"sec\":1444838710,\"usec\":853000},\"additional_info\":{\"qty_diff\":1,\"shop_from\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"qty\":4,\"from\":\"shop\",\"sku\":\"356530S1533_1000-40\",\"order_id\":{\"$id\":\"561e7d2ce4b0c01df26d77e0\"}}}]}}";
        end = System.currentTimeMillis();
        String json="{\"status\":\"ok\",\"data\":{\"events\":[{\"_id\":{\"$id\":\"5628067ae4b06ca4edbc9fc5\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463674,\"usec\":870000},\"additional_info\":{\"qty_diff\":null,\"qty\":3,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"3S0860161_706-TU\"}},{\"_id\":{\"$id\":\"56280684e4b06ca4edbc9fdb\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463684,\"usec\":879000},\"additional_info\":{\"qty_diff\":null,\"qty\":3,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"3S0860161_BD3-TU\"}},{\"_id\":{\"$id\":\"5628068ee4b06ca4edbc9ff1\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463694,\"usec\":869000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"3S0860H2J_001-TU\"}},{\"_id\":{\"$id\":\"56280698e4b06ca4edbca007\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463704,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"3S0905161_06T-TU\"}},{\"_id\":{\"$id\":\"562806a2e4b06ca4edbca01d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463714,\"usec\":874000},\"additional_info\":{\"qty_diff\":null,\"qty\":3,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"3S0905161_174-TU\"}},{\"_id\":{\"$id\":\"562806ace4b06ca4edbca033\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463724,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"3S0905161_706-TU\"}},{\"_id\":{\"$id\":\"562806b6e4b06ca4edbca049\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463734,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"3S0905161_BD3-TU\"}},{\"_id\":{\"$id\":\"562806c0e4b06ca4edbca05f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463744,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"3S1032944_B79-TU\"}},{\"_id\":{\"$id\":\"562806cae4b06ca4edbca075\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463754,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB4201A1001_80001-TU\"}},{\"_id\":{\"$id\":\"562806d4e4b06ca4edbca08b\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463764,\"usec\":869000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB4201A1001_89613-TU\"}},{\"_id\":{\"$id\":\"562806dee4b06ca4edbca0a1\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463774,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":3,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB5935AC266_8K869-TU\"}},{\"_id\":{\"$id\":\"562806e8e4b06ca4edbca0b7\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463784,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB5957A6004_80999-TU\"}},{\"_id\":{\"$id\":\"562806f2e4b06ca4edbca0cd\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463794,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB5966A1001_80648-TU\"}},{\"_id\":{\"$id\":\"562806fce4b06ca4edbca0e3\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463804,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB5966A1001_89613-TU\"}},{\"_id\":{\"$id\":\"56280706e4b06ca4edbca0f9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463814,\"usec\":874000},\"additional_info\":{\"qty_diff\":null,\"qty\":3,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB5998A1001_80648-TU\"}},{\"_id\":{\"$id\":\"56280710e4b06ca4edbca10f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463824,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":3,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB5999A1001_80001-TU\"}},{\"_id\":{\"$id\":\"5628071ae4b06ca4edbca125\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463834,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":3,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB6002A1001_80648-TU\"}},{\"_id\":{\"$id\":\"56280724e4b06ca4edbca13b\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463844,\"usec\":869000},\"additional_info\":{\"qty_diff\":null,\"qty\":6,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB6002A1001_80999-TU\"}},{\"_id\":{\"$id\":\"5628072ee4b06ca4edbca151\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463854,\"usec\":869000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB6002A1001_89613-TU\"}},{\"_id\":{\"$id\":\"56280738e4b06ca4edbca167\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463864,\"usec\":874000},\"additional_info\":{\"qty_diff\":null,\"qty\":4,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB6003A1001_80999-TU\"}},{\"_id\":{\"$id\":\"56280742e4b06ca4edbca17d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463874,\"usec\":871000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB6003A1001_89613-TU\"}},{\"_id\":{\"$id\":\"5628074ce4b06ca4edbca193\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463884,\"usec\":871000},\"additional_info\":{\"qty_diff\":null,\"qty\":3,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB6003A8F48_8S574-TU\"}},{\"_id\":{\"$id\":\"56280756e4b06ca4edbca1a9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463894,\"usec\":870000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB6003AC266_8K870-TU\"}},{\"_id\":{\"$id\":\"56280760e4b06ca4edbca1bf\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463904,\"usec\":875000},\"additional_info\":{\"qty_diff\":null,\"qty\":6,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB6015A1001_80999-TU\"}},{\"_id\":{\"$id\":\"5628076ae4b06ca4edbca1d5\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463914,\"usec\":874000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BB6071A1095_80303-TU\"}},{\"_id\":{\"$id\":\"56280774e4b06ca4edbca1eb\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463924,\"usec\":875000},\"additional_info\":{\"qty_diff\":null,\"qty\":6,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BI0653A1001_80999-TU\"}},{\"_id\":{\"$id\":\"5628077ee4b06ca4edbca201\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463934,\"usec\":875000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"BM1269A1499_80048-TU\"}},{\"_id\":{\"$id\":\"56280788e4b06ca4edbca217\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463944,\"usec\":874000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6797AP724_8B956-40\"}},{\"_id\":{\"$id\":\"56280792e4b06ca4edbca22d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463954,\"usec\":875000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6797AP724_8B956-40.5\"}},{\"_id\":{\"$id\":\"5628079ce4b06ca4edbca243\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463964,\"usec\":875000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6797AP724_8B956-41\"}},{\"_id\":{\"$id\":\"562807a6e4b06ca4edbca259\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463974,\"usec\":871000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6797AP724_8B956-41.5\"}},{\"_id\":{\"$id\":\"562807b0e4b06ca4edbca26f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463984,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6797AP724_8B956-42\"}},{\"_id\":{\"$id\":\"562807bae4b06ca4edbca285\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445463994,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6797AP724_8B956-42.5\"}},{\"_id\":{\"$id\":\"562807c4e4b06ca4edbca29b\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464004,\"usec\":873000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6797AP724_8B956-43\"}},{\"_id\":{\"$id\":\"562807cee4b06ca4edbca2b1\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464014,\"usec\":875000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6797AP724_8B956-43.5\"}},{\"_id\":{\"$id\":\"562807d8e4b06ca4edbca2c7\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464024,\"usec\":875000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6797AP724_8B956-44\"}},{\"_id\":{\"$id\":\"562807e2e4b06ca4edbca2dd\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464034,\"usec\":874000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80058-40\"}},{\"_id\":{\"$id\":\"562807ece4b06ca4edbca2f3\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464044,\"usec\":874000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80058-41\"}},{\"_id\":{\"$id\":\"562807f6e4b06ca4edbca309\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464054,\"usec\":875000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80058-41.5\"}},{\"_id\":{\"$id\":\"56280800e4b06ca4edbca31f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464064,\"usec\":872000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80058-42\"}},{\"_id\":{\"$id\":\"5628080ae4b06ca4edbca335\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464074,\"usec\":874000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80058-42.5\"}},{\"_id\":{\"$id\":\"56280814e4b06ca4edbca34b\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464084,\"usec\":876000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80058-43\"}},{\"_id\":{\"$id\":\"5628081ee4b06ca4edbca361\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464094,\"usec\":879000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80058-43.5\"}},{\"_id\":{\"$id\":\"56280828e4b06ca4edbca377\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464104,\"usec\":876000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80058-44\"}},{\"_id\":{\"$id\":\"56280832e4b06ca4edbca38d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464114,\"usec\":876000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80999-40\"}},{\"_id\":{\"$id\":\"5628083ce4b06ca4edbca3a3\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464124,\"usec\":877000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80999-40.5\"}},{\"_id\":{\"$id\":\"56280846e4b06ca4edbca3ba\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464134,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80999-41\"}},{\"_id\":{\"$id\":\"56280850e4b06ca4edbca3d0\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464144,\"usec\":888000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80999-41.5\"}},{\"_id\":{\"$id\":\"5628085ae4b06ca4edbca3e6\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464154,\"usec\":885000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80999-42\"}},{\"_id\":{\"$id\":\"56280864e4b06ca4edbca3fc\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464164,\"usec\":889000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80999-42.5\"}},{\"_id\":{\"$id\":\"5628086ee4b06ca4edbca412\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464174,\"usec\":890000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80999-43\"}},{\"_id\":{\"$id\":\"56280878e4b06ca4edbca428\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464184,\"usec\":890000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6842AC125_80999-43.5\"}},{\"_id\":{\"$id\":\"56280882e4b06ca4edbca43d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464194,\"usec\":881000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6843AC335_80723-39.5\"}},{\"_id\":{\"$id\":\"5628088ce4b06ca4edbca453\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464204,\"usec\":877000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6843AC335_80723-40\"}},{\"_id\":{\"$id\":\"56280896e4b06ca4edbca46a\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464214,\"usec\":882000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6843AC335_80723-40.5\"}},{\"_id\":{\"$id\":\"562808a0e4b06ca4edbca480\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464224,\"usec\":884000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6843AC335_80723-41.5\"}},{\"_id\":{\"$id\":\"562808aae4b06ca4edbca495\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464234,\"usec\":881000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6843AC335_80723-42\"}},{\"_id\":{\"$id\":\"562808b4e4b06ca4edbca4ab\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464244,\"usec\":878000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6843AC335_80723-42.5\"}},{\"_id\":{\"$id\":\"562808bee4b06ca4edbca4c2\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464254,\"usec\":883000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6843AC335_80723-43\"}},{\"_id\":{\"$id\":\"562808c8e4b06ca4edbca4d7\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464264,\"usec\":878000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6843AC335_80723-43.5\"}},{\"_id\":{\"$id\":\"562808d2e4b06ca4edbca4ed\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464274,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6843AC335_80723-44\"}},{\"_id\":{\"$id\":\"562808dce4b06ca4edbca504\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464284,\"usec\":885000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6870A1096_80999-40\"}},{\"_id\":{\"$id\":\"562808e6e4b06ca4edbca519\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464294,\"usec\":878000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6870A1096_80999-41\"}},{\"_id\":{\"$id\":\"562808f0e4b06ca4edbca530\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464304,\"usec\":893000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6870A1096_80999-41.5\"}},{\"_id\":{\"$id\":\"562808fae4b06ca4edbca546\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464314,\"usec\":895000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6870A1096_80999-42\"}},{\"_id\":{\"$id\":\"56280904e4b06ca4edbca55c\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464324,\"usec\":893000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6870A1096_80999-42.5\"}},{\"_id\":{\"$id\":\"5628090ee4b06ca4edbca571\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464334,\"usec\":881000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CA6870A1096_80999-43\"}},{\"_id\":{\"$id\":\"56280918e4b06ca4edbca588\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464344,\"usec\":893000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0033A1471_80999-36\"}},{\"_id\":{\"$id\":\"56280922e4b06ca4edbca59d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464354,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0033A1471_80999-36.5\"}},{\"_id\":{\"$id\":\"5628092ce4b06ca4edbca5b3\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464364,\"usec\":883000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0033A1471_80999-37\"}},{\"_id\":{\"$id\":\"56280936e4b06ca4edbca5c9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464374,\"usec\":884000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0033A1471_80999-37.5\"}},{\"_id\":{\"$id\":\"56280940e4b06ca4edbca5e0\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464384,\"usec\":892000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0033A1471_80999-38\"}},{\"_id\":{\"$id\":\"5628094ae4b06ca4edbca5f5\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464394,\"usec\":884000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0033A1471_80999-38.5\"}},{\"_id\":{\"$id\":\"56280954e4b06ca4edbca60c\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464404,\"usec\":887000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0033A1471_80999-39\"}},{\"_id\":{\"$id\":\"5628095ee4b06ca4edbca621\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464414,\"usec\":885000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0033A1471_80999-40\"}},{\"_id\":{\"$id\":\"56280968e4b06ca4edbca638\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464424,\"usec\":887000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0046AF967_8K873-35.5\"}},{\"_id\":{\"$id\":\"56280972e4b06ca4edbca64d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464434,\"usec\":885000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0046AF967_8K873-36.5\"}},{\"_id\":{\"$id\":\"5628097ce4b06ca4edbca663\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464444,\"usec\":883000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0046AF967_8K873-37\"}},{\"_id\":{\"$id\":\"56280986e4b06ca4edbca679\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464454,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0046AF967_8K873-37.5\"}},{\"_id\":{\"$id\":\"56280990e4b06ca4edbca68f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464464,\"usec\":883000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0046AF967_8K873-38\"}},{\"_id\":{\"$id\":\"5628099ae4b06ca4edbca6a5\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464474,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0046AF967_8K873-38.5\"}},{\"_id\":{\"$id\":\"562809a4e4b06ca4edbca6bb\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464484,\"usec\":885000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0046AF967_8K873-39\"}},{\"_id\":{\"$id\":\"562809aee4b06ca4edbca6d1\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464494,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80317-36\"}},{\"_id\":{\"$id\":\"562809b8e4b06ca4edbca6e7\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464504,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80317-36.5\"}},{\"_id\":{\"$id\":\"562809c2e4b06ca4edbca6fd\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464514,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80317-37\"}},{\"_id\":{\"$id\":\"562809cce4b06ca4edbca713\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464524,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80317-37.5\"}},{\"_id\":{\"$id\":\"562809d6e4b06ca4edbca729\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464534,\"usec\":879000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80317-38\"}},{\"_id\":{\"$id\":\"562809e0e4b06ca4edbca73f\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464544,\"usec\":881000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80317-38.5\"}},{\"_id\":{\"$id\":\"562809eae4b06ca4edbca755\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464554,\"usec\":882000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80317-39\"}},{\"_id\":{\"$id\":\"562809f4e4b06ca4edbca767\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464564,\"usec\":880000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80317-40\"}},{\"_id\":{\"$id\":\"562809fee4b06ca4edbca780\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464574,\"usec\":878000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80999-36\"}},{\"_id\":{\"$id\":\"56280a08e4b06ca4edbca793\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464584,\"usec\":890000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80999-36.5\"}},{\"_id\":{\"$id\":\"56280a12e4b06ca4edbca7a9\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464594,\"usec\":879000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80999-37\"}},{\"_id\":{\"$id\":\"56280a1ce4b06ca4edbca7bf\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464604,\"usec\":885000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80999-37.5\"}},{\"_id\":{\"$id\":\"56280a26e4b06ca4edbca7d5\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464614,\"usec\":883000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80999-38\"}},{\"_id\":{\"$id\":\"56280a30e4b06ca4edbca7eb\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464624,\"usec\":884000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80999-38.5\"}},{\"_id\":{\"$id\":\"56280a3ae4b06ca4edbca801\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464634,\"usec\":890000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80999-39\"}},{\"_id\":{\"$id\":\"56280a44e4b06ca4edbca818\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464644,\"usec\":893000},\"additional_info\":{\"qty_diff\":null,\"qty\":2,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CD0228A1471_80999-40\"}},{\"_id\":{\"$id\":\"56280a4ee4b06ca4edbca82d\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464654,\"usec\":886000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CG0012A1471_80063-36\"}},{\"_id\":{\"$id\":\"56280a58e4b06ca4edbca843\"},\"shop_id\":{\"$id\":\"55f71cecb49dbbdf4ec6354d\"},\"type\":4,\"date\":{\"sec\":1445464664,\"usec\":886000},\"additional_info\":{\"qty_diff\":null,\"qty\":1,\"stock_price\":0,\"from\":\"csengine\",\"sku\":\"CG0012A1471_80063-36.5\"}}]}}";
        logger.info("获取events事件信息："+json+"，耗时："+(end-start)/1000+"秒");

//        Items[] array = new Gson().fromJson(new StringUtil().getItemsArray(itemsJson),
//                new TypeToken<Items[]>() {}.getType());
        Gson gson = new Gson();
        ReturnDTO returnDTO=gson.fromJson(json, ReturnDTO.class );//new TypeToken<List<SaleDTO>>(){}.getType()
        Map<String,Integer> stockMap = new HashMap<>();
        if("ok".equals(returnDTO.getStatus())){
           List<EventDTO>  eventDTOs  = returnDTO.getData().getEvents();
            for(EventDTO eventDTO:eventDTOs){
                if(0==eventDTO.getType()){//购买减少库存
                   stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                }else if(1==eventDTO.getType()){
                    stockMap.put(eventDTO.getAdditional_info().getSku(),0);
                }else if(2==eventDTO.getType()){
                    stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                }else if(3==eventDTO.getType()){
                    stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                }else if(4==eventDTO.getType()){
                    if(0==eventDTO.getAdditional_info().getStock_price()){//停止销售
                        stockMap.put(eventDTO.getAdditional_info().getSku(),0);
                    }else{
                        stockMap.put(eventDTO.getAdditional_info().getSku(),eventDTO.getAdditional_info().getQty());
                    }

                }

            }


        }

        //定义三方
//        Map returnMap = new HashMap();
//        String key = "";
//        Integer value = null;
//        String[] strArr = json.split("additional_info");
//        System.out.println(strArr.length);
//        logger.info("为TESSABIT供应商产品库存循环赋值");
//        start = System.currentTimeMillis();
//        for (String item:strArr){
//            System.out.println(item+"===========");
//            key = MyStringUtil.getSkuId(item);
//            value = MyStringUtil.getQty(item);
//            System.out.println("Sku ID is - :"+key+",stock is "+value);
//            logger.info("Sku ID is "+key+",stock is "+value);
//            returnMap.put(key,value);
//        }
    }
}
