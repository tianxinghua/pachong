<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.shangpin.ephub.data.mysql.hub.waitselect.mapper.HubWaitSelectMapper" >
  <resultMap id="BaseResultMap" type="com.shangpin.ephub.data.mysql.hub.waitselect.po.HubWaitSelectResponse" >
    <result column="spu_no" property="spuNo" jdbcType="VARCHAR" />
    <result column="color" property="color" jdbcType="VARCHAR" />
    <result column="sku_size" property="skuSize" jdbcType="VARCHAR" />
    
    <result column="sku_size_id" property="skuSizeId" jdbcType="VARCHAR" />
    <result column="sku_no" property="skuNo" jdbcType="VARCHAR" />
    <result column="sp_sku_no" property="spSkuNo" jdbcType="VARCHAR" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="sku_id" property="skuId" jdbcType="VARCHAR" />
    <result column="spu_id" property="spuId" jdbcType="VARCHAR" />
    <result column="spu_model" property="spuModel" jdbcType="VARCHAR" />
    <result column="spu_name" property="spuName" jdbcType="VARCHAR" />
    <result column="gender" property="gender" jdbcType="VARCHAR" />
    <result column="category_no" property="categoryNo" jdbcType="VARCHAR" />
    <result column="brand_no" property="brandNo" jdbcType="VARCHAR" />
    <result column="market_time" property="marketTime" jdbcType="VARCHAR" />
    <result column="hub_color" property="hubColor" jdbcType="VARCHAR" />
    <result column="hub_color_no" property="hubColorNo" jdbcType="VARCHAR" />
    <result column="season" property="season" jdbcType="VARCHAR" />
    <result column="sku_size_type" property="skuSizeType" jdbcType="VARCHAR" />
    <result column="spu_desc" property="spuDesc" jdbcType="VARCHAR" />
    <result column="spu_state" property="spuState" jdbcType="TINYINT" />
    <result column="picture_state" property="pictureState" jdbcType="TINYINT" />
    <result column="picture_export_user" property="pictureExportUser" jdbcType="VARCHAR" />
    <result column="picture_export_time" property="pictureExportTime" jdbcType="TIMESTAMP" />
    <result column="spu_select_state" property="spuSelectState" jdbcType="TINYINT" />
    <result column="new_type" property="newType" jdbcType="TINYINT" />
    <result column="pic_url" property="picUrl" jdbcType="VARCHAR" />
    <result column="origin" property="origin" jdbcType="VARCHAR" />
    <result column="material" property="material" jdbcType="VARCHAR" />
  
    <result column="info_from" property="infoFrom" jdbcType="TINYINT" />
    
    <result column="supplier_sku_no" property="supplierSkuNo" jdbcType="VARCHAR" />
    <result column="sku_supplier_mapping_id" property="skuSupplierMappingId" jdbcType="VARCHAR" />
    <result column="barcode" property="barcode" jdbcType="VARCHAR" />
    <result column="supplier_sku_id" property="supplierSkuId" jdbcType="BIGINT" />
    <result column="supplier_id" property="supplierId" jdbcType="VARCHAR" />
    <result column="new_spu_type" property="newSpuType" jdbcType="TINYINT" />
    <result column="supplier_select_state" property="supplierSelectState" jdbcType="TINYINT" />
    <result column="supplier_no" property="supplierNo" jdbcType="VARCHAR" />
    <result column="supplier_spu_model" property="supplierSpuModel" jdbcType="VARCHAR" />
    <result column="is_new_supplier" property="isNewSupplier" jdbcType="TINYINT" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
    <result column="update_user" property="updateUser" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="selectList" resultMap="BaseResultMap" >
    select
   	map.supplier_no,map.sku_supplier_mapping_id,map.supplier_id,map.supplier_select_state,map.supplier_sku_no,map.memo,map.update_time,map.supplier_sku_id,map.update_user,
   	sku.sku_id,sku.sku_no,map.sp_sku_no,sku.sku_size,sku.sku_size_id,sku.sku_size_type,
   	spu.spu_id,spu.spu_no,spu.spu_model,spu.spu_name,spu.gender,spu.category_no,spu.brand_no,
   	spu.market_time,spu.season,spu.hub_color,spu.hub_color_no,spu.spu_state,spu.pic_url,spu.origin,spu.material,spu.picture_export_user,spu.picture_export_time
    from hub_spu spu  INNER JOIN hub_sku sku on sku.spu_no = spu.spu_no  INNER JOIN  hub_sku_supplier_mapping map on map.sku_no = sku.sku_no  
    where 
    
    	1=1
    	 <if test="null!= supplierSelectState">
    	 
    	 <foreach collection="supplierSelectState" item="item" open="AND map.supplier_select_state IN (" close=")" separator=",">
			#{item}       
     	  </foreach>
	 </if>
	 
    <if test="null!= spSkuNoList">
 		<foreach collection="spSkuNoList" item="item" open="AND map.sp_sku_no IN (" close=")" separator=",">
			#{item}       
     	  </foreach>   
 	</if>
    	
    <if test="null!= operateUser">
	       and   map.update_user = #{operateUser}
	 </if>
     <if test="null!= supplierNo">
	        and        map.supplier_no = #{supplierNo}
	 </if>
	   <if test="null!= brandNo">
	          and        spu.brand_no = #{brandNo}
	 </if>
	   <if test="null!= categoryNo">
	           and  spu.category_no like concat('',#{categoryNo},'%') 
	 </if>
	   <if test="null!= spuModel">
	           and  spu.spu_model like concat('',#{spuModel},'%')
	 </if>
	
	   <if test="null!=startDate">
                and map.update_time >=#{startDate}
      </if>      
       <if test="null!=pictureState">
                and spu.picture_state = #{pictureState}
      </if>      
              
      <if test="null!=endDate">
           <![CDATA[ and map.update_time <=#{endDate}    ]]>
      </if>
      ORDER BY map.update_time desc
      limit #{pageNo} , #{pageSize}
  </select>
   <select id="count" resultType="java.lang.Long" parameterType="com.shangpin.ephub.data.mysql.hub.waitselect.bean.HubWaitSelectRequest">
    select
   	count(*)
    from hub_spu spu INNER JOIN hub_sku sku on sku.spu_no = spu.spu_no  INNER JOIN  hub_sku_supplier_mapping map on map.sku_no = sku.sku_no  
    where 
    
 	 1=1
     <if test="null!= supplierSelectState">
    	 <foreach collection="supplierSelectState" item="item" open="AND map.supplier_select_state IN (" close=")" separator=",">
			#{item}       
     	  </foreach>
	 </if>
	 
	 <if test="null!= spSkuNoList">
 		<foreach collection="spSkuNoList" item="item" open="AND map.sp_sku_no IN (" close=")" separator=",">
			#{item}       
     	  </foreach>   
 	 </if>
	 
	  <if test="null!= operateUser">
	       and   map.update_user = #{operateUser}
	 </if>
	 
     <if test="null!= supplierNo">
	             and   map.supplier_no = #{supplierNo}
	 </if>
	   <if test="null!= brandNo">
	          and      spu.brand_no = #{brandNo}
	 </if>
	   <if test="null!= categoryNo">
	           and  spu.category_no like concat('',#{categoryNo},'%') 
	 </if>
	   <if test="null!= spuModel">
	           and  spu.spu_model like concat('',#{spuModel},'%')
	 </if>
	  <if test="null!=startDate">
                and map.update_time >=#{startDate}
      </if>            
      <if test="null!=endDate">
           <![CDATA[ and map.update_time <=#{endDate}    ]]>
      </if>
  </select>
  
   <select id="selectDetail" resultMap="BaseResultMap" parameterType="com.shangpin.ephub.data.mysql.hub.waitselect.bean.HubWaitSelectDetailRequest">
    select
   	map.supplier_no,map.sku_supplier_mapping_id,map.supplier_id,map.supplier_sku_no,map.supplier_spu_model,map.supplier_select_state,map.barcode,map.supplier_sku_id,
   	sku.sku_id,sku.sku_no,sku.sku_size,sku.sku_size_id,sku.update_time,sku.sku_size_type,
   	spu.spu_id,spu.spu_no,spu.spu_model,spu.spu_name,spu.gender,spu.category_no,spu.brand_no,
   	spu.market_time,spu.season,spu.hub_color,spu.hub_color_no,spu.spu_state,spu.pic_url,spu.origin,spu.material
    from hub_spu spu  INNER JOIN hub_sku sku on sku.spu_no = spu.spu_no  INNER JOIN  hub_sku_supplier_mapping map on map.sku_no = sku.sku_no  
    where 
    
     <if test="null!= skuSupplierMappingId">
	            map.sku_supplier_mapping_id = #{skuSupplierMappingId}
	 </if>
  </select>
  
  
</mapper>