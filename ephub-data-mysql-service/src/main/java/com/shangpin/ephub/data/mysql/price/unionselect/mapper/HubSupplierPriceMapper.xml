<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.shangpin.ephub.data.mysql.price.unionselect.mapper.HubSupplierPriceMapper" >
  <resultMap id="BaseResultMap" type="com.shangpin.ephub.data.mysql.price.unionselect.po.HubSupplierPrice" >
    <result column="supplier_id" property="supplierId" jdbcType="VARCHAR" />
    <result column="supplier_seasonname" property="supplierSeasonName" jdbcType="VARCHAR" />
    <result column="hub_market_time" property="spSeasonYear" jdbcType="VARCHAR" />
    <result column="hub_season" property="spSeasonName" jdbcType="VARCHAR" />
    <result column="market_price" property="markPrice" jdbcType="VARCHAR" />
    <result column="sp_sku_no" property="spSkuId" jdbcType="VARCHAR" />
    <result column="supplier_categoryname" property="categoryName" jdbcType="VARCHAR" />
    <result column="supplier_brandname" property="brandName" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="selectByPriceQuery" resultMap="BaseResultMap" parameterType="com.shangpin.ephub.data.mysql.price.unionselect.bean.PriceQueryDto" >
    select sku.supplier_id,sku.market_price,sku.sp_sku_no,
    spu.supplier_seasonname,spu.supplier_categoryname,spu.supplier_brandname,
    dic.hub_market_time,dic.hub_season
    from hub_supplier_sku sku
    left join hub_supplier_spu spu on sku.supplier_spu_id = spu.supplier_spu_id
    left join hub_season_dic dic on spu.supplier_id = dic.supplierid and spu.supplier_seasonname = dic.supplier_season
    <where>
    sku.sp_sku_no is not null
    <if test="supplierId != null">
    	and sku.supplier_id = #{supplierId}
    </if>
    <if test="spSkuIds != null">
    	and sku.sp_sku_no in 
    	<foreach item="item" index="index" collection="spSkuIds" open="(" separator="," close=")">  
  			#{item}  
 		</foreach> 
    </if>
    <if test="marketSeason != null">
    	and dic.hub_season = #{marketSeason}
    </if>
    <if test="marketYear != null">
    	and dic.hub_market_time = #{marketYear}
    </if>
    ORDER BY sku.create_time desc
    <if test="startRow != null" >
      limit #{startRow} , #{pageSize}
    </if>
    </where>
    
  </select>
  
  <select id="countByQuery" resultType="java.lang.Integer" parameterType="com.shangpin.ephub.data.mysql.price.unionselect.bean.PriceQueryDto">
  	select count(*)
  	from hub_supplier_sku sku
    left join hub_supplier_spu spu on sku.supplier_spu_id = spu.supplier_spu_id
    left join hub_season_dic dic on spu.supplier_id = dic.supplierid and spu.supplier_seasonname = dic.supplier_season
    <where>
    sku.sp_sku_no is not null
    <if test="supplierId != null">
    	and sku.supplier_id = #{supplierId}
    </if>
    <if test="spSkuIds != null">
    	and sku.sp_sku_no in 
    	<foreach item="item" index="index" collection="spSkuIds" open="(" separator="," close=")">  
  			#{item}  
 		</foreach> 
    </if>
    <if test="marketSeason != null">
    	and dic.hub_season = #{marketSeason}
    </if>
    <if test="marketYear != null">
    	and dic.hub_market_time = #{marketYear}
    </if>
    </where>
  </select>
  
</mapper>